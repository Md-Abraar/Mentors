{% extends 'management/adminbase.html' %}
{% comment %} {% load widget_tweaks %} {% endcomment %}
{% block content %}


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <style type="text/css">
      a:link {
        text-decoration: none;
      }
  
      .order-card {
        color: rgb(255, 255, 255);
      }
  
      .bg-c-blue {
        background: #04868f;
      }
  
      .bg-c-green {
        background:#4C51BF;
      }
  
      .bg-c-yellow {
        background: #F56565;
      }
  
      .bg-c-pink {
        background: #663a30;
      }
  
  
      .card {
        
        -webkit-box-shadow: 0 1px 2.94px 0.06px rgba(4, 26, 55, 0.16);
        box-shadow: 0 1px 2.94px 0.06px rgba(4, 26, 55, 0.16);
        border: 1px solid black;
        margin-bottom: 30px;
        -webkit-transition: all 0.3s ease-in-out;
        transition: all 0.3s ease-in-out;
      }
  
      .card .card-block {
        padding: 25px;
      }
  
      .order-card i {
        font-size: 26px;
      }
  
      .f-left {
        float: left;
      }
  
      .f-right {
        float: right;
      }
      header {
      left: 0px;
      right: 0px;
    }
    </style> 

  <div class="container">
    <div class="card">
      <div class="card-body">
        <form action="" method="POST">
          <div class="row align-items-center">
            <div class="col-md-3 align-self-end">
                <label for="sector" class="form-lable">Sector</label>
                <select name="sector" id="sector" class="form-select">
                    <option value="IT">IT</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Electricals">Electrical</option>
                    <option value="Mechanical">Mechanical</option>
                    <option value="Civil">Civil</option>
                </select>                    
            </div>
          <div class="col-md-3 align-self-end">
            <label for="domain" class="form-label">Domain</label>
                <select name="domain" id="domain" class="form-select">
                </select>
          </div> 
          <div class="col-md-3 align-self-end">
            <label for="level" class="form-label" >Level</label>
            <select name="level" id="level" class="form-select">
              <option value="Basic">Basic</option>
              <option value="Intermediate">Intermediate</option>
              <option value="Advanced">Advanced</option>
            </select>
          </div>
          <div class="col-md-3 align-self-end">
            <button class="btn btn-primary mt-4" type="submit">Search</button>
          </div>
        </form>
        <div class="row align-items-end">
          <div class="col-md-3 mt-4">
              <label for="skill" class="form-label">Skill</label>
              <select name="skill" id="skill" class="form-select">
                  {% for i in list %}
                  <option value="{{i}}">{{i}}</option>
                  {% endfor %}
              </select>
          </div>
          <div class="col-md-3 mt-4 align-self-end"> <!-- Added align-self-end class -->
              <button type="button" class="btn btn-primary" id="dashboard">Get Dashboard</button> <!-- Added btn class -->
          </div>
      </div>             
      </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <div class="card-body">
        <canvas id="chartId" aria-label="chart" height="350" width="580"></canvas>
      </div>
    </div>    
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.1.1/chart.min.js"></script>
 <script>
    $(document).ready(function(){
        // Define an object to store the AJAX request parameters and corresponding responses
        $('#sector').change(function(){
            var sector = $(this).val(); 
            // Check if the response for this sector is already cached
                $.ajax({
                    url: '/get_domains',
                    data: {
                        'sector': sector
                    },
                    dataType: 'json',
                    success: function (data){
                        setDomains(data)
                    }
                });
        });
        function setDomains(data){
            var d = $('#domain')
            d.empty();
            $.each(data, function(index, domain){
                d.append('<option value="' + domain + '">' + domain + '</option>');
            });            
        }
        $('#sector').trigger("change")
    }); 
 </script>
 <script>
  {% comment %} function showChart(){
    if (window.myChart instanceof Chart) {
      window.myChart.destroy();
    }
    var chrt = document.getElementById("chartId").getContext("2d");
    var skill = document.getElementById("skill").value;
    var chartId = new Chart(chrt, {
      type: 'doughnut',
      data: {
        labels: ["CSE", "ECE", "EEE", "MECH", "CIVIL", "CST", "CSBS"],
        datasets: [{
          label: "Department wise distribution",
          data: [20, 40, 13, 35, 20, 15, 23],
          backgroundColor: ['#07FAE1', '#07FA1D', '#005C09', '#000857', '#FA0505', '#E0F6E6', '#838E86'],
          hoverOffset: 5
        }],
      },
      options: {
        responsive: false,
        plugins: {
          legend: {
            position: 'bottom', // You can change the position of the legend here
          },
        }
      },
    });
    window.myChart = chartId;
  } {% endcomment %}
</script>
<script>
  $(document).ready(function() {
      $('#dashboard').click(function() {
        var skill = $('#skill').val();
          $.ajax({
            data: {
              'skill': skill
              },
              url: '/get_dashboard_data/',
              success:  function showChart(response){
                var keys = Object.keys(response);
                var values=Object.values(response);

                console.log(keys);
                if (window.myChart instanceof Chart) {
                  window.myChart.destroy();
                }
                var chrt = document.getElementById("chartId").getContext("2d");
              
                var chartId = new Chart(chrt, {
                  type: 'doughnut',
                  data: {
                    labels: keys,
                    datasets: [{
                      label: "Department wise distribution",
                      data: values,
                      backgroundColor: ['#07FAE1', '#07FA1D', '#005C09', '#000857', '#FA0505', '#E0F6E6', '#838E86'],
                      hoverOffset: 5
                    }],
                  },
                  options: {
                    responsive: false,
                    plugins: {
                      legend: {
                        position: 'bottom', // You can change the position of the legend here
                      },
                    }
                  },
                });
                window.myChart = chartId;
              },
              error: function(xhr, errmsg, err) {
                  console.log(xhr.status + ": " + xhr.responseText);  // Log any errors
              }
          });
      });
  });
  </script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
 <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
{% endblock content %}
